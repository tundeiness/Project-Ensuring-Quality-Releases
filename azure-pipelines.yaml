name: Azure Pipelines

# Minimal pipeline to build and deploy infrastructure with Terraform
trigger:
  - main

variables:
  python_version: '3.7.17'
  azureServiceConnectionId: 'servixconnex' 
  projectRoot: $(System.DefaultWorkingDirectory)
  environmentName: 'test'

stages:
- stage: Build
  jobs:
  - job: Build
    pool: myAgentPool
    steps:

    - task: Bash@3
      displayName: 'Install Postman & Newman'
      inputs:
        targetType: 'inline'
        script: |
          #! /bin/bash
          pwd

    - task: TerraformInstaller@0
      displayName: 'Install Terraform'
      inputs:
        terraformVersion: '1.10.5'

    - task: TerraformTaskV1@0
      displayName: 'Initialize Terraform'
      inputs:
        provider: 'azurerm'
        command: 'init'
        workingDirectory: '$(System.DefaultWorkingDirectory)/terraform'
        backendServiceArm: '$(azureServiceConnectionId)'
        backendAzureRmResourceGroupName: 'Azuredevops'
        backendAzureRmStorageAccountName: 'tfstate7393818'
        backendAzureRmContainerName: 'tfstate'
        backendAzureRmKey: '"test.terraform.tfstate"'